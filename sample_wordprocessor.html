<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>单词学习器</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        #controls {
            margin-bottom: 20px;
        }
        #controls input, #controls button {
            margin-right: 10px;
            padding: 8px 12px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            cursor: pointer;
        }
        tr:nth-child(even){background-color: #f9f9f9;}
        tr:hover {background-color: #f1f1f1;}
        .highlight {
            background-color: yellow;
        }
        /* 模态框样式 */
        .modal {
            display: none; 
            position: fixed; 
            z-index: 2000; 
            padding-top: 100px; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.4); 
        }
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 300px;
            border-radius: 5px;
        }
        .modal-content input[type="text"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
        }
        .modal-content button {
            padding: 8px 12px;
            margin-right: 10px;
        }
        /* “我的单词本”样式 */
        #my-words {
            margin-bottom: 30px;
        }
        #my-words table {
            background-color: #f9f9f9;
        }
        .weak {
            background-color: #ffcccc;
        }
        /* 随机抽取按钮样式 */
        #random-selection {
            padding: 10px 20px;
            font-size: 16px;
        }
    </style>
</head>
<body>
    <h1>单词学习器</h1>
    <div id="controls">
        <input type="text" id="search-input" placeholder="搜索单词">
        <button id="search-btn">查找</button>
        <button id="clear-search-btn">清除搜索</button>
        <button id="export-btn">导出为TXT</button>
    </div>

    <h2>所有单词</h2>
    <table id="words-table">
        <thead>
            <tr>
                <th>单词</th>
                <th>释义</th>
                <th>操作</th>
                <th>错误次数</th>
            </tr>
        </thead>
        <tbody>
            <!-- 动态生成内容 -->
        </tbody>
    </table>

    <h2>我的单词本</h2>
    <div id="my-words">
        <table id="my-words-table">
            <thead>
                <tr>
                    <th>单词</th>
                    <th>释义</th>
                    <th>操作</th>
                    <th>错误次数</th>
                </tr>
            </thead>
            <tbody>
                <!-- 动态生成内容 -->
            </tbody>
        </table>
    </div>

    <button id="random-selection">随机抽取单词</button>

    <!-- 模态框 -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <h3 id="modal-title">学习单词</h3>
            <p id="modal-word"></p>
            <input type="text" id="modal-input" placeholder="输入释义">
            <button id="modal-submit-btn">提交</button>
            <button id="modal-cancel-btn">取消</button>
        </div>
    </div>

    <script>
        // 示例单词列表
        const wordsList = [
            { word: "abandon", meaning: "放弃", errors: 0 },
            { word: "benefit", meaning: "利益", errors: 0 },
            { word: "category", meaning: "类别", errors: 0 },
            { word: "define", meaning: "定义", errors: 0 },
            { word: "economy", meaning: "经济", errors: 0 },
            { word: "frequency", meaning: "频率", errors: 0 },
            { word: "generate", meaning: "生成", errors: 0 },
            { word: "habit", meaning: "习惯", errors: 0 },
            { word: "identify", meaning: "识别", errors: 0 },
            { word: "journal", meaning: "期刊", errors: 0 }
            // 可以根据需要添加更多单词
        ];

        // DOM元素
        const wordsTableBody = document.querySelector('#words-table tbody');
        const myWordsTableBody = document.querySelector('#my-words-table tbody');
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const clearSearchBtn = document.getElementById('clear-search-btn');
        const exportBtn = document.getElementById('export-btn');
        const randomSelectionBtn = document.getElementById('random-selection');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalWord = document.getElementById('modal-word');
        const modalInput = document.getElementById('modal-input');
        const modalSubmitBtn = document.getElementById('modal-submit-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');

        let myWords = [];
        let currentQuizWord = null;

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            loadMyWords();
            renderWordsTable();
            renderMyWordsTable();
        });

        // 加载“我的单词本”从localStorage
        function loadMyWords() {
            const stored = localStorage.getItem('myWords');
            if (stored) {
                myWords = JSON.parse(stored);
            }
        }

        // 保存“我的单词本”到localStorage
        function saveMyWords() {
            localStorage.setItem('myWords', JSON.stringify(myWords));
        }

        // 渲染所有单词表格
        function renderWordsTable() {
            wordsTableBody.innerHTML = '';
            wordsList.forEach((wordObj, index) => {
                const tr = document.createElement('tr');

                const tdWord = document.createElement('td');
                tdWord.textContent = wordObj.word;
                tr.appendChild(tdWord);

                const tdMeaning = document.createElement('td');
                tdMeaning.textContent = wordObj.meaning;
                tr.appendChild(tdMeaning);

                const tdAction = document.createElement('td');
                const addBtn = document.createElement('button');
                addBtn.textContent = '添加到我的单词本';
                addBtn.addEventListener('click', () => addToMyWords(wordObj));
                tdAction.appendChild(addBtn);
                tr.appendChild(tdAction);

                const tdErrors = document.createElement('td');
                tdErrors.textContent = wordObj.errors;
                tr.appendChild(tdErrors);

                wordsTableBody.appendChild(tr);
            });
        }

        // 渲染“我的单词本”表格
        function renderMyWordsTable() {
            myWordsTableBody.innerHTML = '';
            myWords.forEach((wordObj, index) => {
                const tr = document.createElement('tr');

                const tdWord = document.createElement('td');
                tdWord.textContent = wordObj.word;
                tr.appendChild(tdWord);

                const tdMeaning = document.createElement('td');
                tdMeaning.textContent = wordObj.meaning;
                tr.appendChild(tdMeaning);

                const tdAction = document.createElement('td');
                const removeBtn = document.createElement('button');
                removeBtn.textContent = '移除';
                removeBtn.addEventListener('click', () => removeFromMyWords(index));
                tdAction.appendChild(removeBtn);
                tr.appendChild(tdAction);

                const tdErrors = document.createElement('td');
                tdErrors.textContent = wordObj.errors;
                tr.appendChild(tdErrors);

                // 根据错误次数高亮显示
                if (wordObj.errors >= 3) {
                    tr.classList.add('weak');
                }

                myWordsTableBody.appendChild(tr);
            });
        }

        // 添加单词到“我的单词本”
        function addToMyWords(wordObj) {
            // 检查是否已经存在
            if (myWords.some(w => w.word === wordObj.word)) {
                alert('该单词已在“我的单词本”中。');
                return;
            }
            myWords.push({ ...wordObj });
            saveMyWords();
            renderMyWordsTable();
        }

        // 从“我的单词本”移除单词
        function removeFromMyWords(index) {
            myWords.splice(index, 1);
            saveMyWords();
            renderMyWordsTable();
        }

        // 搜索单词
        searchBtn.addEventListener('click', () => {
            const query = searchInput.value.trim().toLowerCase();
            if (query === '') return;

            // 清除之前的高亮
            clearHighlights();

            // 遍历所有单词，找到匹配的并高亮
            const rows = wordsTableBody.querySelectorAll('tr');
            rows.forEach(row => {
                const wordCell = row.children[0];
                if (wordCell.textContent.toLowerCase().includes(query)) {
                    wordCell.parentNode.classList.add('highlight');
                }
            });
        });

        // 清除搜索高亮
        clearSearchBtn.addEventListener('click', () => {
            searchInput.value = '';
            clearHighlights();
        });

        function clearHighlights() {
            const highlighted = document.querySelectorAll('.highlight');
            highlighted.forEach(row => row.classList.remove('highlight'));
        }

        // 导出所有单词为TXT
        exportBtn.addEventListener('click', () => {
            let output = '单词\t释义\t错误次数\n';
            wordsList.forEach(wordObj => {
                output += `${wordObj.word}\t${wordObj.meaning}\t${wordObj.errors}\n`;
            });
            const blob = new Blob([output], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'words.txt';
            a.click();
            URL.revokeObjectURL(url);
        });

        // 随机抽取单词（使用模拟退火算法）
        randomSelectionBtn.addEventListener('click', () => {
            if (myWords.length === 0) {
                alert('“我的单词本”为空，请先添加单词。');
                return;
            }
            const selectedWord = simulatedAnnealingSelect(myWords);
            startQuiz(selectedWord);
        });

        // 模拟退火算法选择单词
        function simulatedAnnealingSelect(words) {
            // 初始温度
            let temperature = 100.0;
            // 冷却速率
            const coolingRate = 0.95;
            // 当前解
            let current = words[Math.floor(Math.random() * words.length)];
            // 最佳解
            let best = current;

            while (temperature > 1) {
                // 选择一个随机的邻居
                let neighbor = words[Math.floor(Math.random() * words.length)];
                // 计算当前和邻居的错误次数
                let delta = neighbor.errors - current.errors;

                if (delta > 0 || Math.random() < Math.exp(delta / temperature)) {
                    current = neighbor;
                    if (current.errors > best.errors) {
                        best = current;
                    }
                }

                // 降温
                temperature *= coolingRate;
            }

            return best;
        }

        // 开始测验
        function startQuiz(wordObj) {
            currentQuizWord = wordObj;
            modalTitle.textContent = `请翻译单词：${wordObj.word}`;
            modalWord.textContent = wordObj.word;
            modalInput.value = '';
            modal.style.display = 'block';
            modalInput.focus();
        }

        // 提交测验答案
        modalSubmitBtn.addEventListener('click', () => {
            const userAnswer = modalInput.value.trim().toLowerCase();
            const correctAnswer = currentQuizWord.meaning.toLowerCase();
            if (userAnswer === correctAnswer) {
                alert('回答正确！');
            } else {
                alert(`回答错误。正确答案是：${currentQuizWord.meaning}`);
                // 增加错误次数
                currentQuizWord.errors += 1;
                updateWordErrors(currentQuizWord.word, currentQuizWord.errors);
            }
            modal.style.display = 'none';
        });

        // 取消测验
        modalCancelBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        // 点击模态框外部关闭模态框
        window.addEventListener('click', (event) => {
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        });

        // 更新单词的错误次数
        function updateWordErrors(word, errors) {
            // 更新主单词列表
            const wordObj = wordsList.find(w => w.word === word);
            if (wordObj) {
                wordObj.errors = errors;
            }
            // 更新“我的单词本”
            const myWordObj = myWords.find(w => w.word === word);
            if (myWordObj) {
                myWordObj.errors = errors;
                saveMyWords();
                renderMyWordsTable();
            }
            // 重新渲染主表格
            renderWordsTable();
        }
    </script>
</body>
</html>
